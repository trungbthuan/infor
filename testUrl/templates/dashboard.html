{% extends "sidebar.html" %} {% load static %} {% block content %}
<link rel="stylesheet" type="text/css" href="{% static 'css/myStyle.css' %}" />
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>

<div class="dashboard-container">
    <h1 class="mau-xanh">Bảng Điều Khiển Hệ Thống</h1>

    <div class="stats-row" style="display: flex; gap: 20px; margin-bottom: 30px">
        <div class="card" style="background: #4e73df; color: white; padding: 20px; border-radius: 10px; flex: 1">
            <h3>Tổng Nhân Viên</h3>
            <p style="font-size: 2rem; font-weight: bold">{{ total_staff }}</p>
            <span class="nav-text">Trong đó: {{ male_count }} Nam, {{ female_count }} Nữ </span>
        </div>
    </div>

    <div style="display: flex; gap: 40px; align-items: flex-start">
        <div style="width: 300px">
            <h3 class="mau-xanh">Tỷ lệ Giới tính</h3>
            <canvas id="genderChart"></canvas>
        </div>

        <div style="flex: 1">
            <h3 class="mau-xanh">Nhân viên mới tuyển dụng</h3>
            <table class="styled-table"></table>
        </div>
    </div>
</div>

<script>
    const maleData = {{ male_count }};
    const femaleData = {{ female_count }};
    const total = maleData + femaleData;

    const ctx = document.getElementById('genderChart').getContext('2d');

    new Chart(ctx, {
        type: 'pie',
        // Đăng ký plugin datalabels
        plugins: [ChartDataLabels],
        data: {
            labels: ['Nam', 'Nữ'],
            datasets: [{
                data: [maleData, femaleData],
                backgroundColor: ['#1cc88a', '#f6c23e'],
                hoverOffset: 4
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: {
                    position: 'bottom',
                },
                // Cấu hình hiển thị phần trăm
                datalabels: {
                    color: '#fff', // Màu chữ (trắng cho nổi trên nền màu)
                    font: {
                        weight: 'bold',
                        size: 14
                    },
                    formatter: (value, ctx) => {
                        // Công thức tính %: (giá trị / tổng) * 100
                        let percentage = (value * 100 / total).toFixed(1) + "%";
                        return percentage;
                    },
                }
            }
        }
    });
</script>
{% endblock %}
